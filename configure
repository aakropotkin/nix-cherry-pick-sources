#! /usr/bin/env sh

as_me="configure";

OUTFILE="cfg.mk";

function usage() {
  echo "USAGE: configure [--prefix PATH] [[-o|--output] FILE]";
}

function getopt_drop_eq() {
  cat < /dev/stdin|sed 's/\([ \t]-\{1,2\}[a-zA-Z_][a-zA-Z0-9_-]*\)=/\1 /g';
}

declare -a cfg_vars;
cfg_vars=( prefix );

set -- $( echo " $* "|getopt_drop_eq; ) --;
while : ; do
  case "$1" in
    --prefix)
      shift;
      prefix="$1";
      ;;

    -o|--output)
      shift;
      OUTFILE="$1";
      ;;

    -h|--help)
      usage;
      exit 0;
      ;;

    --)
      shift;
      break;
      ;;

    *)
      echo "$as_me: unrecognized option '$1'" >&2;
      usage >&2;
      exit 1;
      ;;
  esac
  shift;
done

if test -f ./$OUTFILE; then
  mv "./$OUTFILE" "./$OUTFILE~";
fi

echo "# This file was generated by configure. Do not edit!" > "./$OUTFILE";

for var in ${cfg_vars[*]}; do
  if eval "test \"\${$var+set}\" = \"set\";"; then
    eval "echo \"$var = \${$var}\" >> \"./$OUTFILE\";";
  fi
done
